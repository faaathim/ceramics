{% extends "base.html" %}
{% load static %}

{% block top %}
    {% include "user_navbar.html" %}
{% endblock %}

{% block content %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background-color: #1a1a1a;
        color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    .wishlist-main-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .wishlist-title {
        font-size: 2rem;
        font-weight: 300;
        letter-spacing: 4px;
        margin-bottom: 30px;
        text-transform: uppercase;
        color: #ffffff;
    }

    .wishlist-title span {
        font-weight: 700;
    }

    .wishlist-header-row {
        display: grid;
        grid-template-columns: 50px 120px 2fr 1fr 1fr 1fr;
        gap: 20px;
        padding: 20px;
        background-color: #2a2a2a;
        border-radius: 8px;
        margin-bottom: 2px;
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .wishlist-product-row {
        display: grid;
        grid-template-columns: 50px 120px 2fr 1fr 1fr 1fr;
        gap: 20px;
        align-items: center;
        padding: 25px 20px;
        background-color: #0d0d0d;
        margin-bottom: 2px;
        transition: all 0.3s ease;
        position: relative;
    }

    .wishlist-product-row:hover {
        background-color: #333333;
        transform: translateX(5px);
    }

    .wishlist-product-row::after {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 3px;
        background-color: #ff6b35;
        transform: scaleY(0);
        transition: transform 0.3s ease;
    }

    .wishlist-product-row:hover::after {
        transform: scaleY(1);
    }

    .delete-column {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .delete-btn {
        width: 30px;
        height: 30px;
        background: transparent;
        border: 2px solid #404040;
        color: #b0b0b0;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        border-radius: 4px;
    }

    .delete-btn:hover {
        background-color: #dc3545;
        border-color: #dc3545;
        color: white;
        transform: rotate(90deg);
    }

    .image-column img {
        width: 100%;
        height: 100px;
        object-fit: cover;
        border-radius: 4px;
        transition: transform 0.3s ease;
    }

    .wishlist-product-row:hover .image-column img {
        transform: scale(1.05);
    }

    .product-info-column {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .product-name {
        font-size: 0.95rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #ffffff;
    }

    .product-variant {
        font-size: 0.8rem;
        color: #b0b0b0;
    }

    .price-column {
        font-size: 1rem;
        font-weight: 500;
        color: #ffffff;
    }

    .stock-column {
        font-size: 0.85rem;
        color: #28a745;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .stock-column.out-of-stock {
        color: #dc3545;
    }

    .stock-column.unlisted {
        color: #ffa500;
    }

    .action-column {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-add-to-cart {
        background-color: transparent;
        border: 2px solid #ffffff;
        color: #ffffff;
        padding: 12px 24px;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border-radius: 4px;
        font-size: 0.85rem;
        position: relative;
        overflow: hidden;
    }

    .btn-add-to-cart::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background-color: #ffffff;
        transition: left 0.3s ease;
        z-index: 0;
    }

    .btn-add-to-cart span {
        position: relative;
        z-index: 1;
    }

    .btn-add-to-cart:hover {
        color: #0d0d0d;
    }

    .btn-add-to-cart:hover::before {
        left: 0;
    }

    .btn-add-to-cart:disabled {
        border-color: #404040;
        color: #404040;
        cursor: not-allowed;
    }

    .btn-add-to-cart:disabled::before {
        display: none;
    }

    .btn-add-to-cart:disabled:hover {
        color: #404040;
    }

    .empty-message {
        text-align: center;
        padding: 60px 20px;
        font-size: 1.2rem;
        color: #b0b0b0;
    }

    .empty-message a {
        color: #ff6b35;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .empty-message a:hover {
        text-decoration: underline;
        letter-spacing: 2px;
    }

    .heart-icon {
        color: #dc3545;
        font-size: 1.5rem;
        vertical-align: middle;
    }

    @media (max-width: 968px) {
        .wishlist-header-row {
            display: none;
        }

        .wishlist-product-row {
            grid-template-columns: 1fr;
            gap: 15px;
            text-align: center;
        }

        .delete-column,
        .action-column {
            justify-content: center;
        }

        .product-info-column {
            align-items: center;
        }
    }
</style>

<div class="wishlist-main-container">
    <h1 class="wishlist-title">MY WISHLIST <span class="heart-icon">‚ù§Ô∏è</span> <span>({{ items|length }} ITEM{% if items|length != 1 %}S{% endif %})</span></h1>

    {% if items %}
        <div class="wishlist-header-row">
            <div>üóëÔ∏è</div>
            <div>PHOTO</div>
            <div>PRODUCT</div>
            <div>PRICE</div>
            <div>STATUS</div>
            <div>ACTION</div>
        </div>

        {% for item in items %}
        <div class="wishlist-product-row">
            <div class="delete-column">
                <form method="POST" action="{% url 'wishlist:remove' item.variant.id %}">
                    {% csrf_token %}
                    <button type="submit" class="delete-btn">√ó</button>
                </form>
            </div>

            <div class="image-column">
                {% if item.variant.product.main_image %}
                    <img src="{{ item.variant.product.main_image.url }}" alt="{{ item.variant.product.name }}">
                {% else %}
                    <img src="https://via.placeholder.com/120x100/1a1a1a/666?text=No+Image" alt="No image">
                {% endif %}
            </div>

            <div class="product-info-column">
                <div class="product-name">{{ item.variant.product.name }}</div>
                <div class="product-variant">Color: {{ item.variant.color|default:"N/A" }}</div>
            </div>

            <div class="price-column">
                RS.{{ item.variant.product.price }}
            </div>

            <div class="stock-column {% if item.variant.stock <= 0 %}out-of-stock{% elif not item.variant.is_listed %}unlisted{% endif %}">
                {% if not item.variant.is_listed %}
                    Unavailable
                {% elif item.variant.stock > 0 %}
                    In Stock
                {% else %}
                    Out of Stock
                {% endif %}
            </div>

            <div class="action-column">
                {% if item.variant.stock > 0 and item.variant.is_listed %}
                    <form method="POST" action="{% url 'cart:add_to_cart' %}">
                        {% csrf_token %}
                        <input type="hidden" name="variant_id" value="{{ item.variant.id }}">
                        <button type="submit" class="btn-add-to-cart">
                            <span>Move to Cart</span>
                        </button>
                    </form>
                {% else %}
                    <button class="btn-add-to-cart" disabled>
                        <span>{% if item.variant.stock <= 0 %}Out of Stock{% else %}Unavailable{% endif %}</span>
                    </button>
                {% endif %}
            </div>
        </div>
        {% endfor %}

    {% else %}
        <div class="empty-message">
            <p>Your wishlist is empty.</p>
            <a href="{% url 'user_side:shop' %}">Discover Products ‚Üí</a>
        </div>
    {% endif %}
</div>
{% endblock %}